
//PRACTICAL 1
//NAME: Kaiwalya Joshi
//ROLL: 59 -B3

//==============================================================================================

// STAR SCHEMA

//==============================================================================================
SQL CODE FOR STAR SCHEMA :


CREATE TABLE PROMOTION (

PROMOTION_KEY NUMERIC NOT NULL, PROMOTION_CODE  INTEGER, PROMOTION_TYPE VARCHAR(30) NOT NULL, PROMOTION_MEDIUM VARCHAR(30) NOT NULL, DISCOUNT_RATE DECIMAL(2,2),
CONSTRAINT PROMOTION_KEY PRIMARY KEY (PROMOTION_KEY)

);





CREATE TABLE TIME (

TIME_KEY NUMERIC NOT NULL, DATE DATE NOT NULL, DAY_NUMBER INTEGER,
DAY_OF_WEEK VARCHAR(9) NOT NULL, WEEK_NUMBER INTEGER NOT NULL,

MONTH_NUMBER INTEGER, FISCAL_PERIOD VARCHAR NOT NULL, MONTH INTEGER NOT NULL,
QUARTER VARCHAR,

YEAR VARCHAR NOT NULL,

CONSTRAINT TIME_KEY PRIMARY KEY (TIME_KEY)

);





CREATE TABLE STORE (

STORE_KEY NUMERIC NOT NULL, STORE_NAME VARCHAR(50) NOT NULL, MANAGER_NAME VARCHAR(50) NOT NULL, STORE_CODE NUMERIC NOT NULL, ADDRESS VARCHAR(100) NOT NULL, STATE VARCHAR(20) NOT NULL,
ZIP NUMERIC(6) NOT NULL,

CONSTRAINT STORE_KEY PRIMARY KEY (STORE_KEY)

);





CREATE TABLE PRODUCT (

PRODUCT_KEY NUMERIC NOT NULL, PRODUCT_NAME VARCHAR(50) NOT NULL, PRODUCT_CODE NUMERIC NOT NULL, PRODUCT_LINE LONGVARCHAR,
BRAND VARCHAR(30) NOT NULL, DEPARTMENT VARCHAR(10) NOT NULL,
CONSTRAINT PRODUCT_KEY PRIMARY KEY (PRODUCT_KEY)

);





CREATE TABLE SALES_FACT (

PRODUCT_KEY NUMERIC NOT NULL, TIME_KEY NUMERIC NOT NULL, PROMOTION_KEY NUMERIC NOT NULL,

STORE_KEY NUMERIC NOT NULL, SOLD_QUANTITY INTEGER NOT NULL, GROSS_SALES FLOAT NOT NULL, NET_SALES FLOAT NOT NULL,
COST NUMERIC(10,2) NOT NULL, STORE_COUPON_AMT DECIMAL NOT NULL, MFR_COUPON_AMOUNT DECIMAL NOT NULL
);





ALTER TABLE SALES_FACT ADD CONSTRAINT PROMOTION_SALES_FACT_fk FOREIGN KEY (PROMOTION_KEY)
REFERENCES PROMOTION (PROMOTION_KEY) ON DELETE NO ACTION
ON UPDATE NO ACTION NOT DEFERRABLE;


ALTER TABLE SALES_FACT ADD CONSTRAINT TIME_SALES_FACT_fk FOREIGN KEY (TIME_KEY)
REFERENCES TIME (TIME_KEY) ON DELETE NO ACTION
ON UPDATE NO ACTION NOT DEFERRABLE;


ALTER TABLE SALES_FACT ADD CONSTRAINT STORE_SALES_FACT_fk FOREIGN KEY (STORE_KEY)
REFERENCES STORE (STORE_KEY) ON DELETE NO ACTION
ON UPDATE NO ACTION NOT DEFERRABLE;
ALTER TABLE SALES_FACT ADD CONSTRAINT PRODUCT_SALES_FACT_fk FOREIGN KEY (PRODUCT_KEY)
REFERENCES PRODUCT (PRODUCT_KEY) ON DELETE NO ACTION
ON UPDATE NO ACTION NOT DEFERRABLE;


//==============================================================================================



//SNOWFLAKE SCHEMA


//==============================================================================================


CREATE TABLE QUARTER (

QUART_ID NUMERIC NOT NULL, QUARTER VARCHAR,
FISCAL_PERIOD VARCHAR NOT NULL,

CONSTRAINT QUART_ID PRIMARY KEY (QUART_ID)

);





CREATE TABLE ADDRESS (

ADDRESS_KEY NUMERIC NOT NULL, ZIP NUMERIC(6) NOT NULL, ADDRESS VARCHAR(100) NOT NULL, STATE VARCHAR(20) NOT NULL,
CONSTRAINT ADDRESS_KEY PRIMARY KEY (ADDRESS_KEY)

);

CREATE TABLE PROMOTION (

PROMOTION_KEY NUMERIC NOT NULL, PROMOTION_CODE  INTEGER, PROMOTION_TYPE VARCHAR(30) NOT NULL, PROMOTION_MEDIUM VARCHAR(30) NOT NULL, DISCOUNT_RATE DECIMAL(2,2),
CONSTRAINT PROMOTION_KEY PRIMARY KEY (PROMOTION_KEY)

);





CREATE TABLE TIME (

TIME_KEY NUMERIC NOT NULL, QUART_ID NUMERIC NOT NULL, DATE DATE NOT NULL, DAY_NUMBER INTEGER,
DAY_OF_WEEK VARCHAR(9) NOT NULL, WEEK_NUMBER INTEGER NOT NULL, MONTH_NUMBER INTEGER,
MONTH INTEGER NOT NULL, YEAR VARCHAR NOT NULL,
CONSTRAINT TIME_KEY PRIMARY KEY (TIME_KEY)

);





CREATE TABLE STORE (

STORE_KEY NUMERIC NOT NULL, ADDRESS_KEY NUMERIC NOT NULL, STORE_NAME VARCHAR(50) NOT NULL, MANAGER_NAME VARCHAR(50) NOT NULL, STORE_CODE NUMERIC NOT NULL,
CONSTRAINT STORE_KEY PRIMARY KEY (STORE_KEY)

);





CREATE TABLE PRODUCT (

PRODUCT_KEY NUMERIC NOT NULL,

PRODUCT_NAME VARCHAR(50) NOT NULL, PRODUCT_CODE NUMERIC NOT NULL, PRODUCT_LINE LONGVARCHAR,
BRAND VARCHAR(30) NOT NULL, DEPARTMENT VARCHAR(10) NOT NULL,
CONSTRAINT PRODUCT_KEY PRIMARY KEY (PRODUCT_KEY)

);





CREATE TABLE SALES_FACT (

PRODUCT_KEY NUMERIC NOT NULL, TIME_KEY NUMERIC NOT NULL, PROMOTION_KEY NUMERIC NOT NULL, STORE_KEY NUMERIC NOT NULL, SOLD_QUANTITY INTEGER NOT NULL, GROSS_SALES FLOAT NOT NULL, NET_SALES FLOAT NOT NULL,
COST NUMERIC(10,2) NOT NULL, STORE_COUPON_AMT DECIMAL NOT NULL, MFR_COUPON_AMOUNT DECIMAL NOT NULL
);





ALTER TABLE TIME ADD CONSTRAINT QUARTER_TIME_fk FOREIGN KEY (QUART_ID)
REFERENCES QUARTER (QUART_ID) ON DELETE NO ACTION
ON UPDATE NO ACTION NOT DEFERRABLE;


ALTER TABLE STORE ADD CONSTRAINT ADDRESS_STORE_fk FOREIGN KEY (ADDRESS_KEY)
REFERENCES ADDRESS (ADDRESS_KEY) ON DELETE NO ACTION
ON UPDATE NO ACTION NOT DEFERRABLE;

ALTER TABLE SALES_FACT ADD CONSTRAINT PROMOTION_SALES_FACT_fk FOREIGN KEY (PROMOTION_KEY)
REFERENCES PROMOTION (PROMOTION_KEY) ON DELETE NO ACTION
ON UPDATE NO ACTION NOT DEFERRABLE;


ALTER TABLE SALES_FACT ADD CONSTRAINT TIME_SALES_FACT_fk FOREIGN KEY (TIME_KEY)
REFERENCES TIME (TIME_KEY) ON DELETE NO ACTION
ON UPDATE NO ACTION NOT DEFERRABLE;


ALTER TABLE SALES_FACT ADD CONSTRAINT STORE_SALES_FACT_fk FOREIGN KEY (STORE_KEY)
REFERENCES STORE (STORE_KEY) ON DELETE NO ACTION
ON UPDATE NO ACTION NOT DEFERRABLE;


ALTER TABLE SALES_FACT ADD CONSTRAINT PRODUCT_SALES_FACT_fk FOREIGN KEY (PRODUCT_KEY)
REFERENCES PRODUCT (PRODUCT_KEY) ON DELETE NO ACTION
ON UPDATE NO ACTION NOT DEFERRABLE;
-------------------------------------------------------------------------------------------------